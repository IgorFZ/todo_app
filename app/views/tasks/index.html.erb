<%= javascript_include_tag "/javascript/controllers/tasks_controller.js" %>

<p style="color: green"><%= notice %></p>

<h1>Tasks</h1>

<div id="tasks" data-controller="checkbox-select-all">
  <button><%= link_to "New Task", new_task_path %></button>
  <input type="checkbox" id="all" name="all" value="all" data-checkbox-select-all-target="parent" data-action="change->checkbox-select-all#toggleChildren">
    <div id="board">
      <table width="100%">
        <thead>
          <tr>
            <td>Select</td>
            <td>Task Name</td>
            <td>Due Date</td>
            <td>Completed</td>
            <td>Edit</td>
            <td>Delete</td>
          </tr>
        </thead>
        
        <tbody>
          <% @tasks.each do |task| %>
            <tr data-controller="tasks" 
                data-task-update-url="<%= task_path(task) %>">
              <td><input type="checkbox" id="child" name="child" value="child" data-checkbox-select-all-target="child" data-action="change->checkbox-select-all#toggleParent" "tasks_ids[]", evaluation.id></td>   
              <td><%= task.task_title%></td>
              <td><%= task.task_date%></td>
              <td>
              <%= form_with model: task do |form| %>
                <%= form.check_box :task_completed,
                                  data: {
                                    id: task.id,
                                    action: "tasks#toggle"
                                  } %>
                <% end %>
              </td>
              <td>
                <%= link_to edit_task_path(task) do %>
                  <i class="fa fa-edit"></i>
                <% end %>
              </td>
              <td>
                <%= link_to task_path(task), data: { "turbo_method": :delete, turbo_confirm: "Are you sure?" } do %>
                  <i class="fa fa-trash"></i>
                <% end %>
              </td>  
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <%= submit_tag "Delete selected" %>
</div>